<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Jump: Cross-Platform</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; touch-action: manipulation; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; left: 10px; color: #00ffcc; pointer-events: none; font-size: 14px; z-index: 10; text-shadow: 1px 1px 2px #000; }
    </style>
</head>
<body>
    <div id="ui">
        <div id="score">SCORE: 0</div>
        <div id="best">BEST: 0</div>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Configurações de Áudio
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type, duration, vol) {
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + duration);
                gain.gain.setValueAtTime(vol, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            } catch(e) {}
        }

        let gameStarted = false;
        let score = 0, highscore = 0;
        let particles = [], bullets = [], obstacles = [];
        
        const player = {
            x: canvas.width / 2 - 20, y: canvas.height - 100,
            w: 40, h: 40, dx: 0, dy: 0,
            gravity: 0.5, jump: -4.8, speed: 7, friction: 0.9, color: '#00ffcc'
        };

        function drawMenu() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#00ffcc";
            ctx.textAlign = "center";
            ctx.font = "bold 30px sans-serif";
            ctx.fillText("NEON JUMP", canvas.width/2, canvas.height/2 - 40);
            ctx.font = "16px sans-serif";
            ctx.fillText("MOBILE: TOQUE NAS LATERAIS", canvas.width/2, canvas.height/2 + 10);
            ctx.fillText("PC: SETAS OU ESPAÇO", canvas.width/2, canvas.height/2 + 40);
        }

        function createPart(x, y, color) {
            for(let i=0; i<6; i++) {
                particles.push({x, y, sx:(Math.random()-0.5)*8, sy:(Math.random()-0.5)*8, op:1, color});
            }
        }

        function handleAction(type, inputX) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            if (!gameStarted) {
                gameStarted = true;
                return;
            }

            // Movimento lateral
            if (type === 'left') player.dx = -player.speed;
            else if (type === 'right') player.dx = player.speed;
            else if (type === 'touch') {
                if (inputX < canvas.width / 2) player.dx = -player.speed;
                else player.dx = player.speed;
            }

            player.dy += player.jump;
            bullets.push({x: player.x + player.w/2 - 2, y: player.y});
            createPart(player.x + 20, player.y + 40, player.color);
            playSound(880, 'square', 0.1, 0.05);
        }

        // Eventos de Teclado (PC)
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') handleAction('left');
            if (e.key === 'ArrowRight') handleAction('right');
            if (e.key === 'ArrowUp' || e.key === ' ') handleAction('jump');
        });

        // Eventos de Toque (Mobile)
        window.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleAction('touch', e.touches[0].clientX);
        }, {passive: false});

        // Evento de Clique (PC Mouse)
        window.addEventListener('mousedown', (e) => {
            if (!('ontouchstart' in window)) { // Evita disparar duplo no mobile
                handleAction('touch', e.clientX);
            }
        });

        function update() {
            ctx.fillStyle = "rgba(5, 5, 20, 0.4)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (!gameStarted) {
                drawMenu();
                requestAnimationFrame(update);
                return;
            }

            player.x += player.dx;
            player.dx *= player.friction;
            player.dy += player.gravity;
            player.y += player.dy;

            if (player.x < 0) { player.x = 0; player.dx = 0; }
            if (player.x + player.w > canvas.width) { player.x = canvas.width - player.w; player.dx = 0; }
            if (player.y > canvas.height - player.h) { player.y = canvas.height - player.h; player.dy = 0; }

            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.w, player.h);

            if (Math.random() < 0.02) {
                obstacles.push({x: Math.random()*(canvas.width-80), y: -50, w: 80, h: 20, s: 3.5 + score/300});
            }

            obstacles.forEach((o, i) => {
                o.y += o.s;
                ctx.fillStyle = "#ff3300";
                ctx.fillRect(o.x, o.y, o.w, o.h);
                if (player.x < o.x + o.w && player.x + player.w > o.x && player.y < o.y + o.h && player.y + player.h > o.y) {
                    playSound(100, 'sawtooth', 0.5, 0.2);
                    gameStarted = false;
                    if (score > highscore) highscore = score;
                    document.getElementById('best').innerText = "BEST: " + highscore;
                    score = 0; obstacles = []; bullets = [];
                }
            });

            bullets.forEach((b, i) => {
                b.y -= 12;
                ctx.fillStyle = "#fff";
                ctx.fillRect(b.x, b.y, 4, 15);
                obstacles.forEach((o, oi) => {
                    if (b.x < o.x + o.w && b.x + 4 > o.x && b.y < o.y + o.h && b.y + 15 > o.y) {
                        playSound(150, 'sine', 0.1, 0.1);
                        createPart(o.x+o.w/2, o.y+o.h/2, "#ff3300");
                        obstacles.splice(oi, 1);
                        bullets.splice(i, 1);
                        score += 10;
                    }
                });
            });

            particles.forEach((p, i) => {
                p.x += p.sx; p.y += p.sy; p.op -= 0.03;
                ctx.fillStyle = `rgba(0, 255, 204, ${p.op})`;
                ctx.fillRect(p.x, p.y, 3, 3);
                if(p.op <= 0) particles.splice(i, 1);
            });

            document.getElementById('score').innerText = "SCORE: " + score;
            requestAnimationFrame(update);
        }

        update();
    </script>
</body>
</html>
